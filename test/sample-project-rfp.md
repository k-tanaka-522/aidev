# AWS ECS システム構築の相談

## プロジェクト概要

社内の業務システムを AWS ECS（Fargate）で構築したいと考えています。
現在は手動でサーバー管理していますが、運用負荷が高く、スケーラビリティにも課題があります。

## 現状の課題

### 1. サーバー管理の負荷
- 3台の EC2 インスタンスを手動で管理
- OS アップデート、セキュリティパッチ適用に月20時間かかる
- 夜間・休日のサーバートラブル対応で緊急出社が月2-3回発生

### 2. スケーラビリティの問題
- アクセス集中時（月末の集計処理）にサーバーが高負荷
- 手動でインスタンスを追加・削除しており、タイムラグがある
- ピーク時の応答時間が5秒以上になることがある

### 3. デプロイの課題
- Blue/Green デプロイができず、サービス停止が発生（月1回、10分程度）
- デプロイ時のロールバックが手動で30分以上かかる
- デプロイ手順書が属人化しており、担当者不在時は対応不可

## 解決したいこと

### 目的
AWS ECS（Fargate）に移行することで、サーバー管理の負荷を削減し、自動スケーリングとゼロダウンタイムデプロイを実現したい

### 期待効果
1. **運用工数削減**: サーバー管理工数を月20時間から月5時間に削減（75%削減）
2. **可用性向上**: デプロイ時のサービス停止をゼロにする
3. **性能改善**: ピーク時の応答時間を95%ile で 500ms 以内に抑える

## システム要件

### 現行システム
- **アプリケーション**: Node.js 18 + Express（REST API）
- **データベース**: PostgreSQL 14（RDS）
- **フロントエンド**: React 18 SPA（S3 + CloudFront）
- **認証**: JWT トークン
- **利用者数**: 社内ユーザー 100名

### 主要機能
1. 在庫管理（商品の登録・更新・削除・検索）
2. 発注管理（発注書の作成・承認・送信）
3. レポート出力（月次・年次の集計レポート）

### 非機能要件
- **可用性**: 99.9%（月間43分以内のダウンタイム許容）
- **性能**: レスポンスタイム 95%ile < 500ms
- **セキュリティ**: VPC内部にアプリケーションを配置、TLS 1.3 必須
- **スケーラビリティ**: 月末ピーク時に自動スケール（通常2台 → ピーク時5台）

## 制約条件

### 予算
- 初期構築費用: 300万円以内
- 月額運用費用: 10万円以内（AWS利用料含む）

### 納期
- 3ヶ月以内に本番稼働

### 技術制約
- 既存の PostgreSQL データベース（RDS）は継続利用
- 既存の認証基盤（Auth0）との連携が必要
- 社内ネットワークから VPN 経由でアクセス

### 運用要件
- デプロイは週1回のペースで実施
- CloudFormation でインフラをコード管理したい
- CloudWatch でメトリクス・ログを一元管理したい

## 期待する成果物

1. **設計書**
   - システム構成図
   - ECS タスク定義
   - ネットワーク設計（VPC、サブネット、セキュリティグループ）
   - スケーリング設計

2. **インフラコード**
   - CloudFormation テンプレート
   - デプロイスクリプト（Change Set を使用）
   - ロールバックスクリプト

3. **CI/CD パイプライン**
   - GitHub Actions または CodePipeline
   - Blue/Green デプロイ設定

4. **ドキュメント**
   - デプロイ手順書
   - 運用手順書（監視、アラート対応、スケーリング）
   - トラブルシューティングガイド

## 質問・相談したいこと

1. ECS Fargate で本当に運用工数を削減できるのか？
2. 既存システムから移行する際の注意点は？
3. コスト試算（初期費用と月額費用）
4. 推奨するアーキテクチャ構成
5. Blue/Green デプロイの実現方法
6. 監視・アラートの設定方法

以上、よろしくお願いします。
