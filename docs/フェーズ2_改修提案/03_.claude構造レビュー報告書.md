# .claude構造レビュー報告書

**作成日**: 2025-10-31
**目的**: Claude Code公式ベストプラクティスと現在のaiDev構造を比較し、改善点を特定する

---

## 📊 エグゼクティブサマリー

aiDevの `.claude/` 構造は**非常に体系的で詳細**だが、Claude Codeの公式ベストプラクティスとの間にいくつかのギャップが存在する。

**結論**:
- 現在の構造は**そのまま維持すべき**（aiDev独自の強み）
- 不足している公式機能を**追加**することで補完
- 複雑化を避けるため**最小限の追加**に留める

---

## 1. Claude Code 公式ベストプラクティス

### 1.1 推奨ディレクトリ構造

```
project/
├── CLAUDE.md                    # プロジェクトメモリ（必須）
├── .claude/
│   ├── agents/                  # サブエージェント（公式）
│   ├── commands/                # カスタムコマンド
│   ├── settings.json            # プロジェクト設定
│   ├── settings.local.json      # 個人設定（.gitignore）
│   ├── hooks/                   # イベントフック
│   └── skills/                  # 再利用可能タスク
└── .mcp.json                    # MCP設定（オプション）
```

### 1.2 CLAUDE.md のベストプラクティス

- **配置場所**: プロジェクトルート（`./CLAUDE.md`）
- **サイズ**: 100行以下を推奨
- **内容**: プロジェクト固有のパターン、アーキテクチャ決定、コーディング標準
- **インポート**: `@path/to/file` で他ファイルをインポート可能（最大5階層）
- **Git管理**: チェックインしてチーム共有

### 1.3 settings.json のベストプラクティス

- **permissions**: ツール実行の権限管理
- **hooks**: イベント駆動の自動処理
- **env**: 環境変数
- **model**: 使用モデルの指定

### 1.4 サブエージェントのベストプラクティス

- **配置場所**: `.claude/agents/` (プロジェクトレベル) または `~/.claude/agents/` (ユーザーレベル)
- **ファイル形式**: YAML frontmatter付きMarkdown
- **必須フィールド**: `name`, `description`
- **オプション**: `tools` (ツール制限), `model` (モデル指定)
- **設計原則**: 単一責任、詳細なシステムプロンプト、必要最小限のツールアクセス

### 1.5 その他の推奨事項

- **コマンド**: `.claude/commands/*.md` にMarkdown形式
- **シンプルさ**: コンテキスト効率を最大化（不要な情報は削除）
- **チーム共有**: settings.jsonとCLAUDE.mdはgit管理

---

## 2. aiDev の現在の構造

### 2.1 実際のディレクトリ構成

```
aiDev/
├── CLAUDE.md                    # ❌ 存在しない
├── .claude/
│   ├── agents/                  # ✅ サブエージェント定義（公式機能）
│   │   ├── ORCHESTRATION_DESIGN.md
│   │   ├── architect/AGENT.md
│   │   ├── coder/AGENT.md
│   │   ├── consultant/AGENT.md
│   │   ├── qa/AGENT.md
│   │   └── sre/AGENT.md
│   ├── commands/                # ✅ カスタムコマンド
│   │   ├── init.md
│   │   ├── status.md
│   │   ├── next.md
│   │   ├── check.md
│   │   └── check-code.md
│   ├── docs/                    # ✅ 詳細ドキュメント体系（独自）
│   │   ├── 00_core-principles.md
│   │   ├── 10_facilitation/     # フェーズ別ガイド
│   │   │   ├── 2.1_企画フェーズ/
│   │   │   ├── 2.2_要件定義フェーズ/
│   │   │   ├── 2.3_設計フェーズ/
│   │   │   └── 2.4_実装フェーズ/
│   │   └── 40_standards/        # 技術標準
│   │       ├── 41_python.md
│   │       ├── 42_typescript.md
│   │       ├── 44_go.md
│   │       ├── 46_terraform.md
│   │       └── 49_security.md
│   ├── helpers/                 # ✅ ヘルパー（独自）
│   │   ├── state-manager.md
│   │   ├── review-task-generator.md
│   │   ├── directory-structure-helper.md
│   │   └── implementation-checker.md
│   ├── settings.json            # ❌ 存在しない
│   ├── hooks/                   # ❌ 存在しない
│   └── skills/                  # ❌ 存在しない
└── .claude-state/               # ✅ 状態管理（独自）
    ├── project-state.json
    ├── tasks.json
    └── decisions.json
```

### 2.2 aiDev 独自の強み

#### ✅ 優れている点

1. **サブエージェント体系** (`.claude/agents/`) - **公式機能**
   - PM、consultant、architect、coder、qa、sreの明確な役割分担
   - AGENT.mdがYAML frontmatter付きで公式仕様に準拠
   - ORCHESTRATION_DESIGN.mdで統合的な設計思想を文書化（独自の追加）
   - Claude Codeのネイティブサブエージェント機能を正しく活用

2. **詳細なドキュメント体系** (`.claude/docs/`)
   - フェーズ別の詳細ガイド
   - ヒアリング項目、チェックリスト、製造物構成
   - 技術標準の体系化

3. **ヘルパー機能** (`.claude/helpers/`)
   - 状態管理、レビュータスク生成、実装チェッカーなど
   - 再利用可能なユーティリティ

4. **状態管理** (`.claude-state/`)
   - プロジェクト状態の永続化
   - フェーズ遷移の記録
   - 意思決定の履歴

5. **カスタムコマンド**
   - `/init`, `/status`, `/next`, `/check` など実用的なコマンド群

#### ⚠️ 改善余地がある点

- ドキュメント量が膨大（コンテキスト効率の観点で課題の可能性）
- 深いネスト構造

---

## 3. ギャップ分析

### 3.1 不足している公式機能

| 機能 | 公式推奨 | aiDev現状 | 優先度 | 理由 |
|------|----------|-----------|--------|------|
| **agents/** | ✅ 公式 | ✅ あり | - | 既に実装済み（公式仕様準拠） |
| **CLAUDE.md** | ✅ 必須 | ❌ なし | ⭐⭐⭐ | プロジェクトメモリのエントリーポイント |
| **settings.json** | ✅ 推奨 | ❌ なし | ⭐⭐⭐ | 権限管理、Hooks定義 |
| **hooks/** | ✅ 推奨 | ❌ なし | ⭐⭐ | イベント駆動の自動処理 |
| **skills/** | ✅ 推奨 | ❌ なし | ⭐ | 再利用可能タスク（Skillsと.docs/の重複あり） |
| **.mcp.json** | 🔵 オプション | ❌ なし | ⭐ | MCP設定（低優先度） |

### 3.2 公式準拠 vs 独自構造

| 機能 | 種別 | 評価 | 判断 |
|------|------|------|------|
| `.claude/agents/` | ✅ 公式 | ✅ 優秀 | **維持すべき** - 公式仕様に正しく準拠 |
| `.claude/docs/` | 🔵 独自 | ⚠️ 膨大 | **維持 + 整理** - CLAUDE.mdから参照する形に |
| `.claude/helpers/` | 🔵 独自 | ✅ 有用 | **維持すべき** - 実用的なユーティリティ |
| `.claude-state/` | 🔵 独自 | ✅ 独自価値 | **維持すべき** - セッション継続性の要 |
| `ORCHESTRATION_DESIGN.md` | 🔵 独自 | ✅ 有用 | **維持すべき** - 設計思想の文書化 |

---

## 4. 具体的な改善提案

### 4.1 必須の追加（Phase 1）

#### 1. CLAUDE.md の作成

**配置**: プロジェクトルート (`aiDev/CLAUDE.md`)

**内容** (100行以内):

```markdown
# AI開発ファシリテーター (aiDev)

自然言語対話でシステム開発プロセス全体をファシリテートするAIアシスタント。

## PM役割定義

あなたは **PM (プロジェクトマネージャー)** として振る舞います。

@.claude/agents/ORCHESTRATION_DESIGN.md      # サブエージェント設計思想

## プロジェクト構造

@.claude/docs/00_core-principles.md          # 基本原則

## 利用可能なコマンド

- `/init` - プロジェクト初期化
- `/status` - 現在の状況確認
- `/next` - 次のアクション提案

## サブエージェント

- **consultant**: ビジネス課題分析
- **architect**: アーキテクチャ設計
- **coder**: 実装
- **qa**: 品質保証
- **sre**: インフラ・運用

## 技術標準

@.claude/docs/40_standards/     # 言語別標準規約

## 対話原則

- 一問一答形式
- ビジネス背景を最優先
- 設計駆動実装

## 状態管理

`.claude-state/` でプロジェクト状態を永続化。
セッションをまたいだ継続性を確保。
```

**効果**:
- エントリーポイントが明確になる
- PMの役割が明示される
- 詳細ドキュメントは`@`インポートで参照
- 100行以内で全体像を把握可能

**既存プロジェクトへの展開**:
- CLAUDE.mdはプロジェクト固有の情報を含むため、テンプレートからコピーして編集が必要
- `.claude/templates/CLAUDE.md.template` にテンプレートを配置
- `/init` コマンドで自動セットアップ手順を提供

---

#### 2. settings.json の作成

**配置**: `.claude/settings.json`

**内容**:

```json
{
  "permissions": {
    "allow": [
      {"toolPattern": "Read|Grep|Glob", "pathPattern": "**"},
      {"toolPattern": "WebSearch|WebFetch", "pathPattern": "*"}
    ],
    "ask": [
      {"toolPattern": "Write|Edit", "pathPattern": "**"},
      {"toolPattern": "Bash", "pathPattern": "*"}
    ],
    "deny": [
      {"toolPattern": "*", "pathPattern": ".env*"},
      {"toolPattern": "*", "pathPattern": "**/*.pem"},
      {"toolPattern": "*", "pathPattern": "**/.aws/credentials"},
      {"toolPattern": "*", "pathPattern": "**/secrets/**"}
    ]
  },
  "env": {
    "AIDEV_PROJECT_ROOT": ".",
    "AIDEV_STATE_DIR": ".claude-state"
  },
  "includeCoAuthoredBy": true,
  "model": "claude-sonnet-4-5-20250929"
}
```

**効果**:
- シークレット保護
- 調査系ツールは自動許可（スピード）
- 変更系ツールは確認（安全）

---

#### 3. .gitignore の更新

```
# Claude Code 個人設定
.claude/settings.local.json
```

---

### 4.2 推奨の追加（Phase 2 - 運用後に判断）

#### 4. SessionStart Hook

**配置**: `.claude/hooks/session-start.js`

**目的**: セッション開始時に自動的にプロジェクト状態を読み込む

**settings.jsonに追加**:
```json
{
  "hooks": {
    "SessionStart": [{
      "matcher": "*",
      "hooks": [{"type": "command", "command": "node .claude/hooks/session-start.js"}]
    }]
  }
}
```

**効果**:
- `/init` や `/status` コマンドを手動実行不要
- 毎回自動でコンテキスト復元

---

#### 5. PreToolUse Hook（実装チェッカー）

**配置**: `.claude/hooks/pre-write-check.js`

**目的**: Write/Edit時に設計書の実装方針を自動チェック

**効果**:
- 設計駆動実装の強制
- 「設計書なしコード生成」を物理的にブロック

---

### 4.3 慎重に検討すべき追加（Phase 3以降）

#### 6. Skills

**配置**: `.claude/skills/*/SKILL.md`

**懸念点**:
- `.claude/docs/` と役割が重複
- Skillsが増えすぎるとメンテナンス困難
- aiDevは既に詳細なドキュメント体系がある

**推奨判断**:
- **当面は不要**
- 運用中に「ここブレる」「ここ間違える」ポイントが明確になったら、そのポイントだけSkills化

---

## 5. 現在の構造の最適化提案

### 5.1 .claude/docs/ の整理

#### 現状の課題
- ドキュメント数が膨大（200ファイル以上）
- 深いネスト構造
- すべてをClaude が読み込むとコンテキスト圧迫

#### 最適化案

**CLAUDE.mdからのインポート構造**:

```markdown
# AI開発ファシリテーター

## 基本原則
@.claude/docs/00_core-principles.md

## フェーズ別ガイド（必要時に参照）
- 企画: @.claude/docs/10_facilitation/2.1_企画フェーズ/INDEX.md
- 要件定義: @.claude/docs/10_facilitation/2.2_要件定義フェーズ/INDEX.md
- 設計: @.claude/docs/10_facilitation/2.3_設計フェーズ/INDEX.md
- 実装: @.claude/docs/10_facilitation/2.4_実装フェーズ/INDEX.md

## 技術標準（言語選定後に参照）
@.claude/docs/40_standards/

## ヘルパー（必要時に参照）
@.claude/helpers/
```

**効果**:
- 初期読み込みは最小限（CLAUDE.md + core-principles.md）
- 詳細ドキュメントは必要時にインポート
- コンテキスト効率の向上

---

### 5.2 INDEX.md の活用

各フェーズディレクトリに `INDEX.md` を配置し、そこから詳細ファイルを参照:

```markdown
# 企画フェーズ INDEX

## 概要
@2.1.1_フェーズ概要.md

## ヒアリング
@2.1.2_ヒアリング項目/2.1.2.1_ビジネス背景ヒアリング.md
...

## チェックリスト
@2.1.3_決定事項チェックリスト.md
```

**効果**:
- 階層的な情報アクセス
- 必要な部分だけ読み込み

---

## 6. 提案機能の妥当性再評価

### 6.1 前回提案した機能のレビュー

| 提案機能 | 公式推奨 | aiDevに必要か | 優先度 | 判断理由 |
|----------|----------|---------------|--------|----------|
| **CLAUDE.md** | ✅ | ✅ | ⭐⭐⭐ | エントリーポイントとして必須 |
| **settings.json（権限）** | ✅ | ✅ | ⭐⭐⭐ | シークレット保護は必須 |
| **SessionStart Hook** | ✅ | ✅ | ⭐⭐ | UX向上（コマンド入力不要） |
| **PreToolUse Hook** | ✅ | ✅ | ⭐⭐ | 設計駆動実装の強制 |
| **Skills** | ✅ | ❓ | ⭐ | `.claude/docs/`と重複。当面不要 |
| **Status Line** | ✅ | 🔵 | ⭐ | あると便利だがオプション |
| **レビュー記録** | ❌ | ❓ | ⭐ | 独自機能。運用後に判断 |
| **標準規約動的生成** | ❌ | ❓ | ⭐ | 独自機能。運用後に判断 |

### 6.2 最終推奨

#### 即座に実装すべき（Phase 1）

1. **CLAUDE.md** - エントリーポイント
2. **settings.json** - 権限管理のみ（Hooksは後回し）
3. **.gitignore更新** - settings.local.json除外

#### 運用してから判断（Phase 2）

4. **SessionStart Hook** - 自動状態読み込み
5. **PreToolUse Hook** - 実装チェッカー

#### 当面不要（Phase 3以降）

6. **Skills** - `.claude/docs/`で十分
7. **その他の独自機能** - 実際の問題が出てから

---

## 7. 実装ロードマップ

### Week 1: Phase 1実装

**Day 1**:
- [x] CLAUDE.md作成（プロジェクトルート）
- [x] settings.json作成（権限のみ）
- [x] .gitignore更新

**Day 2-3**:
- [ ] .claude/docs/ にINDEX.mdを追加（各フェーズ）
- [ ] CLAUDE.mdのインポート構造を調整

**Day 4-5**:
- [ ] 動作確認
- [ ] ドキュメント更新

### Week 2-3: 運用・評価

- 実際にaiDevを使用
- 「困った点」「ブレた点」を記録
- Phase 2の必要性を判断

### Week 4-: Phase 2実装（必要な場合のみ）

- SessionStart Hook
- PreToolUse Hook

---

## 8. まとめ

### 8.1 現在の評価

**aiDevの.claude/構造は非常に優れている**:
- サブエージェント体系が明確
- 詳細なドキュメント
- 状態管理の仕組み

**不足しているのは公式の標準機能のみ**:
- CLAUDE.md（エントリーポイント）
- settings.json（権限管理）

### 8.2 推奨アクション

1. **即座に追加**: CLAUDE.md + settings.json
2. **運用後に判断**: Hooks
3. **当面不要**: Skills

### 8.3 複雑化の回避

- **最小限の追加**に留める
- 既存の強み（`.claude/docs/`, `.claude/agents/`）は維持
- 「公式機能を使うべき」という理由だけで追加しない
- 実際の問題解決に必要なものだけ追加

---

**作成日**: 2025-10-31
**次のアクション**: Phase 1の実装承認を得る
