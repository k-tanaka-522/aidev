# 3周テスト レビュープロセス

**目的**: 各周の終了後、システムアーキテクト・CTO 視点でレビューし、技術標準・`.claude` をブラッシュアップする

---

## 🎯 レビューの目的

### 重要な認識

**この3周テストは成果物を作ることが目的ではない**

目的は:
1. **技術標準（`.claude/docs/40_standards/`）の不足を洗い出す**
2. **PHASE_GUIDE.md の実用性を検証・改善する**
3. **CLAUDE.md の指示が十分か確認する**
4. **`.claude/` 配下のドキュメントをブラッシュアップする**

**AWS-ECS-Forgate は題材に過ぎない**

---

## 👨‍💼 レビュー観点（システムアーキテクト・CTO）

### 1. 技術標準の完全性

#### 1.1 CloudFormation 標準（45_cloudformation.md）

**レビュー項目**:
- [ ] **デプロイスクリプトが生成されたか**
  - 問題: AWS-ECS-Forgate にはデプロイスクリプトがなかった
  - 期待: aidev 使用後は自動生成されるべき
  - 検証: `scripts/` に以下が存在するか
    - `create-changeset.sh`
    - `describe-changeset.sh`
    - `execute-changeset.sh`
    - `rollback.sh`

- [ ] **スクリプトが実際に動作するか**
  - dry-run が成功するか
  - Change Set の内容が確認できるか
  - デプロイが成功するか
  - ロールバックが成功するか

- [ ] **スクリプトの品質は十分か**
  - エラーハンドリングがあるか
  - ログ出力が適切か
  - パラメータ検証があるか
  - ヘルプメッセージがあるか

**発見された不足を記録**:

```markdown
## CloudFormation 標準の不足

### 問題1: デプロイスクリプトの品質が低い
**現状**:
- エラーハンドリングがない
- ログ出力が不十分
- パラメータ検証がない

**改善案**:
- `45_cloudformation.md` に「デプロイスクリプトの品質基準」を追加
- Good Example を追加（エラーハンドリング、ログ出力、パラメータ検証）

**対応**:
- [ ] `45_cloudformation.md` を更新
- [ ] `2.4.6.1.7_デプロイ自動化設計.md` に Good Example を追加
```

#### 1.2 Python 標準（41_python.md）

**レビュー項目**:
- [ ] **FastAPI のベストプラクティスが含まれているか**
  - 問題: 現状は一般的な Python 規約のみ
  - 期待: FastAPI 特有のパターン（依存性注入、ミドルウェア、エラーハンドリング等）

- [ ] **非同期処理のパターンが含まれているか**
  - async/await の使い方
  - asyncio のベストプラクティス

- [ ] **テストのパターンが含まれているか**
  - pytest の設定
  - モック・フィクスチャの使い方
  - カバレッジ目標

**発見された不足を記録**:

```markdown
## Python 標準の不足

### 問題1: FastAPI 特有のパターンがない
**現状**:
- 一般的な Python 規約のみ
- FastAPI のベストプラクティスがない

**改善案**:
- `41_python.md` に「FastAPI セクション」を追加
- 依存性注入、ミドルウェア、エラーハンドリングの Good Example を追加

**対応**:
- [ ] `41_python.md` を更新
- [ ] FastAPI プロジェクト構成の Good Example を追加
```

#### 1.3 セキュリティ・運用標準（49_security.md）

**レビュー項目**:
- [ ] **ECS Fargate のセキュリティベストプラクティスが含まれているか**
  - タスクロールの最小権限
  - シークレット管理（Secrets Manager）
  - VPC 設定（プライベートサブネット）

- [ ] **監視・アラートの基準が含まれているか**
  - CloudWatch Logs の設定
  - CloudWatch Alarms の設定
  - メトリクス収集

**発見された不足を記録**:

```markdown
## セキュリティ・運用標準の不足

### 問題1: ECS Fargate のセキュリティパターンがない
**現状**:
- 一般的なセキュリティ原則のみ
- ECS Fargate 特有のベストプラクティスがない

**改善案**:
- `49_security.md` に「ECS Fargate セキュリティ」セクションを追加
- タスクロール、シークレット管理、VPC 設定の Good Example を追加

**対応**:
- [ ] `49_security.md` を更新
```

### 2. PHASE_GUIDE.md の実用性

#### 2.1 企画フェーズ PHASE_GUIDE.md

**レビュー項目**:
- [ ] **Claude が読み込んだか**
  - 会話ログから確認
  - 読み込んでいない場合、CLAUDE.md の指示が不足

- [ ] **一問一答になっていたか**
  - 複数質問を同時にしていないか
  - ユーザーが疲れていないか

- [ ] **ユーザーの言葉で質問していたか**
  - 技術用語を使っていないか
  - ビジネス的な質問になっていたか

- [ ] **PDCA 2周目（抜け漏れチェック）を実行したか**
  - 企画書生成前に振り返りがあったか
  - 追加質問があったか

**発見された不足を記録**:

```markdown
## 企画フェーズ PHASE_GUIDE.md の不足

### 問題1: Claude が PHASE_GUIDE.md を読み込まなかった
**現状**:
- CLAUDE.md に記載があるが、実際に読み込まれなかった

**改善案**:
- CLAUDE.md の「会話開始時の必読事項」をより強調
- PHASE_GUIDE.md の読み込みを必須とする指示を追加

**対応**:
- [ ] CLAUDE.md を更新
- [ ] 読み込み確認の仕組み（例: PHASE_GUIDE.md の冒頭に確認用フレーズを入れる）
```

#### 2.2 設計フェーズ PHASE_GUIDE.md

**レビュー項目**:
- [ ] **代替案・トレードオフが提示されたか**
  - 技術選定の理由が明確か
  - 他の選択肢（代替案）が示されたか
  - トレードオフが説明されたか

- [ ] **システム構成図が生成されたか**
  - Mermaid 図が生成されたか
  - 図が分かりやすいか

**発見された不足を記録**:

```markdown
## 設計フェーズ PHASE_GUIDE.md の不足

### 問題1: 代替案・トレードオフの提示が不十分
**現状**:
- PHASE_GUIDE.md に「代替案・トレードオフを提示する」と書いてあるが、実際には提示されなかった

**改善案**:
- PHASE_GUIDE.md に「代替案・トレードオフの提示方法」を具体化
- Good Example を追加（例: ECS Fargate vs EKS vs Lambda）

**対応**:
- [ ] `2.3_設計フェーズ/PHASE_GUIDE.md` を更新
```

#### 2.3 実装フェーズ PHASE_GUIDE.md

**レビュー項目**:
- [ ] **事前説明 → 生成 → 事後説明の原則が守られたか**
  - コード生成前に概要説明があったか
  - コード生成後にポイント説明があったか

- [ ] **技術標準が参照されたか**
  - Python 標準（41_python.md）
  - CloudFormation 標準（45_cloudformation.md）

- [ ] **テストコードが生成されたか**
  - pytest のテストコードが存在するか
  - カバレッジ 80%+ を目指しているか

**発見された不足を記録**:

```markdown
## 実装フェーズ PHASE_GUIDE.md の不足

### 問題1: テストコードの生成が不十分
**現状**:
- テストコードが一部しか生成されなかった
- カバレッジ 80%+ に達していない

**改善案**:
- PHASE_GUIDE.md に「テストコード生成の必須化」を追加
- テストカバレッジの確認方法を明記

**対応**:
- [ ] `2.4_実装フェーズ/PHASE_GUIDE.md` を更新
```

#### 2.4 納品フェーズ PHASE_GUIDE.md

**レビュー項目**:
- [ ] **デプロイ手順書に dry-run が含まれているか**
  - Change Set 作成手順があるか
  - Change Set 確認手順があるか
  - Change Set 実行手順があるか

- [ ] **ロールバック手順が含まれているか**

- [ ] **README.md が十分か**
  - セットアップ手順が具体的か
  - トラブルシューティングがあるか

**発見された不足を記録**:

```markdown
## 納品フェーズ PHASE_GUIDE.md の不足

### 問題1: デプロイ手順書の dry-run 説明が不十分
**現状**:
- dry-run の重要性は記載されているが、具体的な確認ポイントが不明

**改善案**:
- PHASE_GUIDE.md に「Change Set 確認のチェックリスト」を追加
- 意図しない削除を見逃さないための確認ポイントを明記

**対応**:
- [ ] `2.6_納品フェーズ/PHASE_GUIDE.md` を更新
```

### 3. 新しい技術標準の必要性

#### 3.1 不足している技術標準

**レビュー項目**:
- [ ] **Docker 標準が必要か**
  - Dockerfile のベストプラクティス
  - マルチステージビルド
  - セキュリティ（非 root ユーザー、脆弱性スキャン）

- [ ] **GitHub Actions 標準が必要か**
  - CI/CD パイプライン
  - デプロイ自動化
  - テスト自動化

- [ ] **SQL 標準が必要か**
  - マイグレーション（Alembic）
  - インデックス設計
  - パフォーマンスチューニング

**発見された不足を記録**:

```markdown
## 新しい技術標準の必要性

### 追加すべき標準1: Docker 標準
**理由**:
- ECS Fargate ではコンテナイメージが必須
- Dockerfile のベストプラクティスが必要

**内容**:
- マルチステージビルド
- セキュリティ（非 root ユーザー）
- イメージサイズ最適化
- .dockerignore の設定

**対応**:
- [ ] `.claude/docs/40_standards/47_docker.md` を作成

### 追加すべき標準2: GitHub Actions 標準
**理由**:
- CI/CD パイプラインが必須
- デプロイ自動化のベストプラクティスが必要

**内容**:
- ワークフロー構成
- シークレット管理
- デプロイ承認フロー（本番環境）

**対応**:
- [ ] `.claude/docs/40_standards/48_github_actions.md` を作成
```

### 4. プロセス定義の不足

#### 4.1 不足しているプロセス定義

**レビュー項目**:
- [ ] **CI/CD 構築プロセスが必要か**
  - 現状: 実装フェーズに含まれているが、詳細が不足
  - 期待: 独立したプロセスとして定義

- [ ] **セキュリティレビュープロセスが必要か**
  - 現状: セキュリティ標準はあるが、レビュー手順がない
  - 期待: レビューチェックリスト

**発見された不足を記録**:

```markdown
## プロセス定義の不足

### 追加すべきプロセス1: CI/CD 構築プロセス
**理由**:
- 実装フェーズに含まれているが、詳細が不足
- GitHub Actions のセットアップ手順が必要

**内容**:
- GitHub Actions ワークフロー設計
- CI パイプライン（テスト自動化）
- CD パイプライン（デプロイ自動化）
- 本番環境への承認フロー

**対応**:
- [ ] `.claude/docs/10_facilitation/2.4_実装フェーズ/2.4.7_CICD構築プロセス/` を作成
```

---

## 📝 レビュー実施手順

### 各周の終了後に実施

#### Step 1: 成果物の確認

**生成されたファイルをすべて確認**:

```bash
cd /c/dev2/test-projects/round1

# ディレクトリ構造確認
tree -L 3

# ドキュメント確認
ls -la docs/

# コード確認
ls -la src/
ls -la tests/
ls -la infra/

# スクリプト確認
ls -la scripts/
```

#### Step 2: システムアーキテクト視点のレビュー

**以下の観点で評価**:

1. **アーキテクチャの妥当性**
   - [ ] 技術選定は適切か
   - [ ] スケーラビリティは考慮されているか
   - [ ] セキュリティは十分か
   - [ ] コストは最適化されているか

2. **設計の品質**
   - [ ] システム構成図は分かりやすいか
   - [ ] コンポーネント分割は適切か
   - [ ] インターフェース設計は適切か

3. **実装の品質**
   - [ ] コーディング規約に準拠しているか
   - [ ] テストカバレッジは十分か
   - [ ] エラーハンドリングは適切か

#### Step 3: CTO 視点のレビュー

**以下の観点で評価**:

1. **技術標準の完全性**
   - [ ] 今回のプロジェクトで不足している標準はないか
   - [ ] 新しいベストプラクティスが見つかったか

2. **プロセスの実用性**
   - [ ] PHASE_GUIDE.md は実用的だったか
   - [ ] 改善が必要な箇所はどこか

3. **組織的な観点**
   - [ ] チームで使えるレベルか
   - [ ] 属人化を防げているか
   - [ ] 品質が担保されているか

#### Step 4: 改善アクションの整理

**優先度付け**:

```markdown
## 改善アクション（1周目終了後）

### 優先度: 高（2周目開始前に必ず対応）

1. **デプロイスクリプトの品質基準を追加**
   - 対象: `45_cloudformation.md`
   - 内容: エラーハンドリング、ログ出力、パラメータ検証の Good Example
   - 担当: [あなた]
   - 期限: 2周目開始前

2. **FastAPI セクションを追加**
   - 対象: `41_python.md`
   - 内容: FastAPI のベストプラクティス、依存性注入、ミドルウェア
   - 担当: [あなた]
   - 期限: 2周目開始前

### 優先度: 中（2周目で検証、3周目前に対応）

1. **Docker 標準を作成**
   - 対象: 新規ファイル `47_docker.md`
   - 内容: Dockerfile のベストプラクティス
   - 担当: [あなた]
   - 期限: 3周目開始前

### 優先度: 低（3周目終了後に検討）

1. **GitHub Actions 標準を作成**
   - 対象: 新規ファイル `48_github_actions.md`
   - 内容: CI/CD パイプライン
   - 担当: [あなた]
   - 期限: 3周目終了後
```

#### Step 5: 改善の実施

**aidev を更新**:

```bash
cd /c/dev2/aiDev

# 改善実施（例: CloudFormation 標準の更新）
# .claude/docs/40_standards/45_cloudformation.md を編集

# Git コミット
git add .claude/docs/40_standards/45_cloudformation.md
git commit -m "1周目レビュー: デプロイスクリプトの品質基準を追加

- エラーハンドリングの Good Example
- ログ出力の Good Example
- パラメータ検証の Good Example

レビュー観点: デプロイスクリプトの品質が低かったため、
具体的な実装例を追加。"
```

#### Step 6: 次周への準備

**改善版を新しいディレクトリにコピー**:

```bash
mkdir -p /c/dev2/test-projects/round2
cd /c/dev2/test-projects/round2

# 改善版 aidev をコピー
cp -r /c/dev2/aiDev/.claude .
cp -r /c/dev2/aiDev/.claude-state .
cp /c/dev2/aiDev/CLAUDE.md .
cp /c/dev2/aiDev/.gitignore .

# .claude-state をクリア
rm -rf .claude-state/*
```

---

## 📊 最終レビュー（3周目終了後）

### 総合評価

**aidev の完成度を評価**:

```markdown
## aidev 総合評価

### 完成度: XX%

### 評価基準

#### 技術標準（40%）
- [ ] 主要な技術がカバーされているか（Python, TypeScript, Go, CloudFormation, Terraform）
- [ ] 実用的なベストプラクティスが含まれているか
- [ ] Good/Bad Example が十分か
- **評価**: XX/40点

#### PHASE_GUIDE.md（30%）
- [ ] 全フェーズが網羅されているか
- [ ] 実用的な指示になっているか
- [ ] 一問一答が機能しているか
- **評価**: XX/30点

#### プロセス定義（20%）
- [ ] 175ファイルが整理されているか
- [ ] 実用的な内容か
- [ ] PHASE_GUIDE.md との連携が適切か
- **評価**: XX/20点

#### 対話品質（10%）
- [ ] CLAUDE.md の指示が適切か
- [ ] 対話のスタイルが自然か
- [ ] ユーザー体験が良いか
- **評価**: XX/10点

### 総合点: XX/100点

### 実用レベル判定
- [ ] 80点以上: 本番プロジェクトで使用可能
- [ ] 60-79点: 一部改善すれば使用可能
- [ ] 60点未満: さらなる改善が必要
```

### Bedrock Multi-Agent 化の判断

**評価基準**:

```markdown
## Bedrock Multi-Agent 化の必要性

### 判断基準

#### aidev で十分なケース
- [ ] PHASE_GUIDE.md で問題なく動作する
- [ ] コンテキストサイズが問題にならない
- [ ] ユーザー体験が十分に良い
- **結論**: aidev（PHASE_GUIDE.md）で継続

#### Bedrock Multi-Agent が必要なケース
- [ ] コンテキストサイズが限界に達する
- [ ] 複数の専門知識を並行して活用したい
- [ ] より自然なオーケストレーションが必要
- **結論**: Bedrock Multi-Agent に移行

### 最終判断: [aidev継続 / Bedrock移行]

### 移行する場合の優先Agent
1. [Agent名] - [理由]
2. [Agent名] - [理由]
```

---

**作成日**: 2025-10-24
**作成者**: Claude（AI開発ファシリテーター）
