# 2.4.5.1.5 テストコード生成（pytest）

## 📋 目的

pytestを使用したテストコードを生成する

---

## 📁 テストディレクトリ構成

```
tests/
├── __init__.py
├── conftest.py                 # pytest設定・fixture
├── test_models/
│   ├── __init__.py
│   └── test_user.py
├── test_routers/
│   ├── __init__.py
│   └── test_users.py
└── test_services/
    ├── __init__.py
    └── test_user_service.py
```

---

## ✅ テストコードパターン

### パターン1: 基本的なテスト

```python
# ✅ Good Example
import pytest
from src.services.user_service import get_user

def test_get_user_正常系():
    """ユーザー取得の正常系テスト"""
    # Arrange
    user_id = 1
    
    # Act
    user = get_user(user_id)
    
    # Assert
    assert user["id"] == 1
    assert user["name"] == "Taro"

def test_get_user_異常系_ユーザーが存在しない():
    """ユーザー取得の異常系テスト（ユーザーが存在しない）"""
    # Arrange
    user_id = 9999
    
    # Act & Assert
    with pytest.raises(UserNotFoundError):
        get_user(user_id)
```

### パターン2: fixture使用

```python
# conftest.py
import pytest

@pytest.fixture
def sample_user():
    """テスト用ユーザーデータ"""
    return {"id": 1, "name": "Taro", "email": "taro@example.com"}

# test_user_service.py
def test_create_user(sample_user):
    """ユーザー作成テスト"""
    result = create_user(sample_user)
    assert result["id"] == sample_user["id"]
```

### パターン3: FastAPI テスト

```python
# ✅ Good Example
from fastapi.testclient import TestClient
from src.main import app

client = TestClient(app)

def test_read_user():
    """GET /users/{user_id} のテスト"""
    response = client.get("/users/1")
    assert response.status_code == 200
    assert response.json()["id"] == 1
```

---

## ✅ チェックリスト

- [ ] tests/ ディレクトリ作成
- [ ] conftest.py 作成（fixture定義）
- [ ] テスト関数名：日本語で意図明確化
- [ ] Arrange-Act-Assert パターン
- [ ] 正常系・異常系両方テスト

---

**最終更新**: 2025-10-19
