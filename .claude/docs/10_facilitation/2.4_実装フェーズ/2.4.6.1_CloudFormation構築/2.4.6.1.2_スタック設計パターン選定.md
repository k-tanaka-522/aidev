# 2.4.6.1.2 スタック設計パターン選定（CloudFormation）

## 📋 目的

CloudFormationスタックの設計パターンを選定する

---

## 🏗️ スタック分割パターン

### パターン1: レイヤー別分割（推奨）

```
infra/
├── 01-network.yaml           # VPC, Subnet, IGW, NAT
├── 02-security.yaml          # SecurityGroup, NACL
├── 03-compute.yaml           # EC2, ECS, Lambda
├── 04-database.yaml          # RDS, DynamoDB
└── 05-storage.yaml           # S3, EFS
```

**メリット:**
- 変更影響範囲が明確
- 段階的なデプロイが可能
- チーム分業しやすい

**デメリット:**
- スタック間の依存関係管理が必要（Outputs/Imports）

---

### パターン2: 環境別分割

```
infra/
├── common/                   # 環境共通（VPC, IAM等）
│   └── network.yaml
├── dev/                      # 開発環境
│   ├── compute.yaml
│   └── database.yaml
├── stg/                      # ステージング環境
│   ├── compute.yaml
│   └── database.yaml
└── prod/                     # 本番環境
    ├── compute.yaml
    └── database.yaml
```

---

### パターン3: モノリススタック（小規模）

```
infra/
└── all-resources.yaml        # 全リソースを1ファイル
```

**メリット:**
- 管理が簡単
- 小規模プロジェクト向き

**デメリット:**
- ファイルが巨大化
- 変更影響範囲が不明確

---

## 📝 選定基準

| 条件 | 推奨パターン |
|------|------------|
| リソース数 < 20 | モノリス |
| リソース数 20-50 | レイヤー別 |
| リソース数 > 50 | レイヤー別 + 環境別 |
| チーム人数 > 3 | レイヤー別 |

---

## ✅ チェックリスト

- [ ] プロジェクト規模を確認
- [ ] スタック分割パターンを選定
- [ ] スタック間依存関係を設計
- [ ] Outputs/Imports を設計

---

**最終更新**: 2025-10-19
