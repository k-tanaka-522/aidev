# 2.4.6.1.4 Change Sets運用フロー（CloudFormation）

## 📋 目的

CloudFormationのChange Setsを使った安全なデプロイフロー

---

## 🔄 Change Sets運用フロー

### ステップ1: Change Set作成

```bash
aws cloudformation create-change-set \
  --stack-name my-stack \
  --change-set-name my-changeset-$(date +%Y%m%d%H%M%S) \
  --template-body file://template.yaml \
  --parameters file://parameters.json \
  --capabilities CAPABILITY_IAM
```

---

### ステップ2: Change Set内容確認 ⭐⭐⭐最重要

```bash
aws cloudformation describe-change-set \
  --stack-name my-stack \
  --change-set-name my-changeset-20251019120000
```

**確認項目:**
- [ ] 変更されるリソース
- [ ] 削除されるリソース（❗注意）
- [ ] 新規作成されるリソース
- [ ] 想定外の変更がないか

---

### ステップ3: ユーザー承認を得る

```
AI: Change Setを作成しました。以下の変更が行われます：

[追加]
- EC2インスタンス: WebServer01
- SecurityGroup: WebServerSG

[変更]
- RDS: インスタンスタイプを t3.micro → t3.small に変更

[削除]
- なし

想定通りでしょうか？問題なければデプロイします。
```

---

### ステップ4: Change Set実行

```bash
# ユーザー承認後
aws cloudformation execute-change-set \
  --stack-name my-stack \
  --change-set-name my-changeset-20251019120000
```

---

### ステップ5: デプロイ結果確認

```bash
aws cloudformation describe-stacks \
  --stack-name my-stack \
  --query 'Stacks[0].StackStatus'
```

**期待値:** `UPDATE_COMPLETE`

---

## ⚠️ 注意事項

### 削除系の変更は特に注意

Change Setで以下が表示された場合は**必ずユーザーに確認**：

- **Delete（削除）**: リソースが削除される
- **Replacement=True**: リソースが作り直される（データ消失の可能性）

---

## ✅ チェックリスト

- [ ] Change Set作成
- [ ] Change Set内容確認
- [ ] 削除・置換がないか確認
- [ ] ユーザー承認取得
- [ ] Change Set実行
- [ ] デプロイ結果確認

---

**最終更新**: 2025-10-19
