# ドメインディレクトリ構成（基本設計書）

## 概要

基本設計書を **ドメインごとにディレクトリ分割** し、設計書・パラメーターシート・図をセットで管理します。

---

## 従来の問題点

### ❌ 単一ファイル方式

```
docs/
└── 03_基本設計書.md  # 1ファイルに全て詰め込む（500〜1000行）
```

**問題点**:
- ファイルが長すぎて読みづらい
- Git 差分が見にくい
- 複数人で編集しにくい（競合しやすい）
- 図とパラメーターが混在して煩雑

---

## ✅ ドメインディレクトリ方式（推奨）

```
docs/03_基本設計/
├── INDEX.md                          # 全体サマリー
├── 01_システム構成/
│   ├── システム構成設計書.md          # Why/How（設計理由・方針）
│   ├── システム構成図.drawio          # draw.io ファイル
│   └── システム構成図.png             # PNG エクスポート
├── 02_ネットワーク/
│   ├── ネットワーク設計書.md          # Why/How
│   ├── パラメーターシート.md          # What（設定値）
│   ├── ネットワーク図.drawio
│   └── ネットワーク図.png
├── 03_コンピューティング/
│   ├── コンピューティング設計書.md
│   ├── パラメーターシート.md
│   └── （図は任意）
├── 04_データベース/
│   ├── データベース設計書.md
│   └── パラメーターシート.md
├── 05_認証認可/
│   ├── 認証認可設計書.md
│   └── パラメーターシート.md
├── 06_ストレージ/
│   ├── ストレージ設計書.md
│   └── パラメーターシート.md
├── 07_監視ログ/
│   ├── 監視ログ設計書.md
│   └── パラメーターシート.md
├── 08_セキュリティ/
│   ├── セキュリティ設計書.md
│   └── パラメーターシート.md
├── 09_デプロイ/
│   ├── デプロイ設計書.md
│   └── パラメーターシート.md
├── 10_DR/
│   ├── DR設計書.md
│   └── パラメーターシート.md
└── 99_全体サマリー/
    ├── コスト試算.md
    ├── 命名規則.md
    └── ユーザー確認事項.md
```

---

## メリット

### 1. **役割が明確**
- **設計書**: Why（なぜ）+ How（どうやって）
- **パラメーターシート**: What（具体的な設定値）
- **図**: 視覚的な説明

### 2. **Git 差分が見やすい**
- ドメインごとにファイルが分かれているため、変更の影響範囲が明確
- レビューしやすい

### 3. **複数人で編集しやすい**
- ドメインごとに担当を分けられる
- ファイル競合が起きにくい

### 4. **拡張が容易**
- 将来、テスト仕様書や別紙を同じディレクトリに追加可能

---

## ドメインの分け方

### インフラプロジェクト（AWS 等）

| # | ドメイン | 内容 |
|---|---------|------|
| 01 | システム構成 | マルチアカウント構成、全体構成図 |
| 02 | ネットワーク | VPC、サブネット、ルーティング |
| 03 | コンピューティング | ECS、EC2、Lambda 等 |
| 04 | データベース | RDS、DynamoDB 等 |
| 05 | 認証認可 | Cognito、IAM 等 |
| 06 | ストレージ | S3、EBS 等 |
| 07 | 監視ログ | CloudWatch、SNS 等 |
| 08 | セキュリティ | WAF、暗号化、監査ログ |
| 09 | デプロイ | CI/CD、GitHub Actions 等 |
| 10 | DR | 災害対策、バックアップ |
| 99 | 全体サマリー | コスト試算、命名規則、確認事項 |

### アプリケーション開発

| # | ドメイン | 内容 |
|---|---------|------|
| 01 | システム構成 | 全体アーキテクチャ |
| 02 | データベース | ER図、テーブル設計 |
| 03 | API | RESTful API、エンドポイント設計 |
| 04 | 画面 | 画面遷移図、UI/UX 設計 |
| 05 | 認証認可 | ログイン、権限管理 |
| 06 | バッチ | バッチ処理、スケジュール |
| 07 | 外部連携 | 外部 API、連携仕様 |
| 08 | セキュリティ | 脆弱性対策、暗号化 |
| 09 | テスト | テスト戦略、テスト仕様 |
| 10 | デプロイ | CI/CD、リリース手順 |
| 99 | 全体サマリー | コスト試算、命名規則 |

---

## 設計書とパラメーターシートの分離

### 設計書（Why/How）

**目的**: 設計理由と方針を記載

**内容**:
- なぜその技術・アーキテクチャを選んだのか（ADR: Architecture Decision Records）
- どうやって実現するのか（実現方法）
- 非機能要件をどう満たすのか

**例**（ネットワーク設計書.md）:
```markdown
# ネットワーク設計書

## 設計方針

### マルチAZ配置
**理由**: 可用性99.9%を実現するため、2つのAZにリソースを配置

### 3層サブネット構成
**理由**: セキュリティを強化するため、Public/Private/DBの3層に分離

## 実現方法

### Public Subnet
- インターネットゲートウェイにルーティング
- NAT Gateway を配置

### Private Subnet
- NAT Gateway 経由でインターネットアクセス
- アプリケーション層を配置

### DB Subnet
- インターネットアクセス不可
- RDS を配置
```

---

### パラメーターシート（What）

**目的**: 具体的な設定値を一覧化

**内容**:
- CIDR、IPアドレス
- リソース名
- インスタンスタイプ、スペック
- 設定パラメータ

**例**（パラメーターシート.md）:
```markdown
# ネットワーク パラメーターシート

## VPC

| 項目 | dev | stg | prod |
|-----|-----|-----|------|
| VPC CIDR | 10.0.0.0/16 | 10.1.0.0/16 | 10.2.0.0/16 |
| リージョン | ap-northeast-1 | ap-northeast-1 | ap-northeast-1 |

## サブネット

### Public Subnet

| AZ | CIDR (dev) | CIDR (stg) | CIDR (prod) |
|----|-----------|-----------|------------|
| ap-northeast-1a | 10.0.1.0/24 | 10.1.1.0/24 | 10.2.1.0/24 |
| ap-northeast-1c | 10.0.2.0/24 | 10.1.2.0/24 | 10.2.2.0/24 |

### Private Subnet

| AZ | CIDR (dev) | CIDR (stg) | CIDR (prod) |
|----|-----------|-----------|------------|
| ap-northeast-1a | 10.0.11.0/24 | 10.1.11.0/24 | 10.2.11.0/24 |
| ap-northeast-1c | 10.0.12.0/24 | 10.1.12.0/24 | 10.2.12.0/24 |

### DB Subnet

| AZ | CIDR (dev) | CIDR (stg) | CIDR (prod) |
|----|-----------|-----------|------------|
| ap-northeast-1a | 10.0.21.0/24 | 10.1.21.0/24 | 10.2.21.0/24 |
| ap-northeast-1c | 10.0.22.0/24 | 10.1.22.0/24 | 10.2.22.0/24 |

## NAT Gateway

| 環境 | AZ | Elastic IP |
|-----|----|-----------|
| dev | ap-northeast-1a | (自動割り当て) |
| stg | ap-northeast-1a | (自動割り当て) |
| prod | ap-northeast-1a | (自動割り当て) |
| prod | ap-northeast-1c | (自動割り当て) |
```

---

## INDEX.md の役割

**目的**: 全体サマリーとナビゲーション

**内容**:
- プロジェクト概要
- ドキュメント構成の一覧（リンク付き）
- 重要な設計判断（ADR サマリー）
- 技術スタック
- 非機能要件の実現方針
- コスト試算（サマリー）
- レビュー・承認状況

**例**:
```markdown
# プロジェクト名 基本設計書 INDEX

## ドキュメント構成

| # | ドメイン | 設計書 | パラメーター | 概要 |
|---|---------|-------|------------|------|
| 01 | システム構成 | [設計書](01_システム構成/システム構成設計書.md) | - | 全体構成図 |
| 02 | ネットワーク | [設計書](02_ネットワーク/ネットワーク設計書.md) | [パラメーター](02_ネットワーク/パラメーターシート.md) | VPC、サブネット |
...

## 重要な設計判断（ADR）

### ADR-001: ECS Fargate 採用
**決定**: AWS ECS Fargate を採用
**理由**: サーバーレスコンテナによる運用負荷削減、オートスケーリング
```

---

## ベストプラクティス

### 1. **設計書は簡潔に**
- Why/How に集中
- 具体的な設定値はパラメーターシートへ
- 1ファイル 100〜200行程度

### 2. **パラメーターシートは網羅的に**
- 環境ごと（dev/stg/prod）に表形式で記載
- CloudFormation の Parameters と対応させる

### 3. **図は別ファイルで管理**
- draw.io ファイル（`.drawio`）+ PNG エクスポート
- Markdown に PNG を埋め込む

### 4. **Git コミットは小さく**
- ドメインごとにコミット
- 例: `feat: Add network design document`

---

## 実装例

sampleAWS-subagent プロジェクトで実際に採用されています：

- リポジトリ: https://github.com/k-tanaka-522/Sample-AWS-SubAgent
- ディレクトリ: `docs/03_基本設計/`

---

**作成者**: PM
**最終更新**: 2025-10-29
