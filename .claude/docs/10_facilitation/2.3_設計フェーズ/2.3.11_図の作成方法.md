# 図の作成方法（Mermaid vs draw.io）

## 概要

基本設計書・詳細設計書では、システム構成図、ネットワーク図、ER図等の図を作成します。

図の作成方法は、**プロジェクトの規模・複雑度**に応じて選択します。

---

## 図の作成方法の選択

### 方法1: Mermaid（Markdown内記述）

**推奨**: 小〜中規模プロジェクト、シンプルな図

**メリット**:
- ✅ Markdown に直接記述できる（テキストベース）
- ✅ Git 差分が見やすい
- ✅ Claude が直接生成・編集できる
- ✅ GitHub、VSCode でプレビュー可能
- ✅ バージョン管理が容易

**デメリット**:
- ❌ 複雑な図は表現しにくい
- ❌ レイアウトの細かい調整ができない
- ❌ AWS 公式アイコン等は使えない

**使用例**:
- システム構成図（シンプルな構成）
- シーケンス図
- ER図（テーブル数が少ない）
- フローチャート

---

### 方法2: draw.io（専用ツール）

**推奨**: 中〜大規模プロジェクト、複雑な図

**メリット**:
- ✅ 複雑な図を詳細に表現できる
- ✅ AWS 公式アイコンが使える
- ✅ レイアウトの細かい調整が可能
- ✅ 見栄えの良い図が作れる
- ✅ PNG/SVG エクスポートでドキュメントに埋め込める

**デメリット**:
- ❌ バイナリファイル（XML）なので Git 差分が見にくい
- ❌ Claude が直接編集しにくい（MCP を使えば可能）
- ❌ 専用ツールが必要（draw.io Desktop または Web版）

**使用例**:
- システム構成図（マルチアカウント、複雑な構成）
- ネットワーク図（VPC、サブネット、ルーティング）
- ER図（テーブル数が多い）
- インフラ構成図

---

## draw.io を使った図の作成フロー

### 1. draw.io ファイルの作成

#### ツールのインストール
- **draw.io Desktop**: https://github.com/jgraph/drawio-desktop/releases
- または **Web版**: https://app.diagrams.net/

#### ファイル配置
```
docs/03_基本設計/
├── 01_システム構成/
│   ├── システム構成図.drawio       # draw.io ファイル（編集用）
│   ├── システム構成図.png          # PNG エクスポート（表示用）
│   ├── システム構成図_分析.md      # 図の詳細説明（オプション）
│   └── システム構成設計書.md       # 設計書本体
```

### 2. AWS アイコンの使用

draw.io には AWS 公式アイコンが組み込まれています。

**使い方**:
1. draw.io を開く
2. 左サイドバーの「その他の図形」をクリック
3. 「AWS」カテゴリを有効化
4. AWS サービスアイコンをドラッグ＆ドロップ

**よく使うアイコン**:
- Compute: EC2, ECS, Lambda
- Network: VPC, ALB, NAT Gateway
- Database: RDS, DynamoDB
- Storage: S3, EBS
- Security: Cognito, Secrets Manager, WAF

### 3. エクスポート（SVG + PNG）

draw.io ファイルを SVG と PNG の両方にエクスポートします。

#### エクスポート戦略

| 形式 | 用途 | タイミング |
|------|------|-----------|
| **SVG** | PM レビュー用 | architect サブエージェントが図を作成した直後 |
| **PNG** | ドキュメント埋め込み用 | PM レビュー・修正完了後 |

**理由**:
- SVG は Claude が読み込んで内容を理解できる（テキスト、構造が保持される）
- PM が図をレビューして改善提案が可能
- PNG は最終版のみ生成（ドキュメント用）

#### ファイル配置（ワークフロー）

```
docs/03_基本設計/01_システム構成/
├── システム構成図.drawio       # 編集用（Git管理）
├── システム構成図.svg          # PM レビュー用（一時的、Git管理）
└── システム構成図.png          # ドキュメント用（最終版、Git管理）
```

#### 方法A: draw.io Desktop の GUI でエクスポート

**SVG エクスポート**（PM レビュー用）:
1. draw.io Desktop でファイルを開く
2. メニュー: `File` → `Export as` → `SVG...`
3. オプション設定:
   - Border: 20px
   - Transparent: チェックを外す（白背景）
4. 保存

**PNG エクスポート**（ドキュメント用）:
1. draw.io Desktop でファイルを開く
2. メニュー: `File` → `Export as` → `PNG...`
3. オプション設定:
   - Width: 2400px（高解像度）
   - Border: 20px
   - Transparent: チェックを外す（白背景）
4. 保存

#### 方法B: draw.io CLI でエクスポート（推奨）

**SVG エクスポート**（PM レビュー用）:

```bash
# Windows
"C:\Program Files\draw.io\draw.io.exe" -x -f svg \
  -o "docs\03_基本設計\01_システム構成\システム構成図.svg" \
  --border 20 \
  "docs\03_基本設計\01_システム構成\システム構成図.drawio"

# macOS / Linux
/Applications/draw.io.app/Contents/MacOS/draw.io -x -f svg \
  -o "docs/03_基本設計/01_システム構成/システム構成図.svg" \
  --border 20 \
  "docs/03_基本設計/01_システム構成/システム構成図.drawio"
```

**PNG エクスポート**（ドキュメント用）:

```bash
# Windows
"C:\Program Files\draw.io\draw.io.exe" -x -f png \
  -o "docs\03_基本設計\01_システム構成\システム構成図.png" \
  --width 2400 \
  --border 20 \
  "docs\03_基本設計\01_システム構成\システム構成図.drawio"

# macOS / Linux
/Applications/draw.io.app/Contents/MacOS/draw.io -x -f png \
  -o "docs/03_基本設計/01_システム構成/システム構成図.png" \
  --width 2400 \
  --border 20 \
  "docs/03_基本設計/01_システム構成/システム構成図.drawio"
```

**オプション説明**:
- `-x`: エクスポートモード
- `-f svg` / `-f png`: SVG / PNG 形式で出力
- `-o`: 出力ファイルパス
- `--width 2400`: 幅を2400pxに指定（PNG のみ、高解像度）
- `--border 20`: 図の周囲に20pxのボーダーを追加

### 4. Markdown への埋め込み

PNG 画像を Markdown ドキュメントに埋め込みます。

```markdown
# システム構成設計書

## システム構成図

![システム構成図](./システム構成図.png)

## 説明

...
```

---

## draw.io 図の作成ベストプラクティス

### 1. レイヤーを活用

複雑な図は、レイヤーで分割します。

- **Layer 1: 背景**（VPC、サブネット等の枠）
- **Layer 2: インフラ**（EC2、RDS 等のリソース）
- **Layer 3: 矢印・ラベル**（通信フロー、説明）

### 2. 色分けルール

一貫性のある色分けを使用します。

| 色 | 用途 |
|----|------|
| 青系 | Public Subnet、インターネット向けリソース |
| 緑系 | Private Subnet、アプリケーション層 |
| オレンジ系 | DB Subnet、データ層 |
| 赤系 | セキュリティ、認証、監視 |
| グレー | 外部サービス、拠点 |

### 3. 矢印のルール

通信フローを明確にします。

- **実線矢印**: 通常の通信
- **破線矢印**: バックアップ、参照のみ
- **太線矢印**: メインフロー
- **細線矢印**: サブフロー

### 4. 凡例を追加

図の右下に凡例を追加します。

```
【凡例】
🔵 Public Subnet
🟢 Private Subnet
🟠 DB Subnet
➡️ 通信フロー
```

---

## 自動化スクリプト（オプション）

複数の draw.io ファイルを一括で SVG / PNG に変換するスクリプトを用意します。

### Windows バッチスクリプト

`scripts/convert-drawio.bat`:

```batch
@echo off
echo Converting draw.io files to SVG and PNG...

set DRAWIO="C:\Program Files\draw.io\draw.io.exe"
set BASE_DIR=docs\03_基本設計

REM システム構成図
%DRAWIO% -x -f svg -o "%BASE_DIR%\01_システム構成\システム構成図.svg" --border 20 "%BASE_DIR%\01_システム構成\システム構成図.drawio"
%DRAWIO% -x -f png -o "%BASE_DIR%\01_システム構成\システム構成図.png" --width 2400 --border 20 "%BASE_DIR%\01_システム構成\システム構成図.drawio"

REM ネットワーク図
%DRAWIO% -x -f svg -o "%BASE_DIR%\02_ネットワーク\ネットワーク図.svg" --border 20 "%BASE_DIR%\02_ネットワーク\ネットワーク図.drawio"
%DRAWIO% -x -f png -o "%BASE_DIR%\02_ネットワーク\ネットワーク図.png" --width 2400 --border 20 "%BASE_DIR%\02_ネットワーク\ネットワーク図.drawio"

echo Conversion completed!
pause
```

### macOS / Linux シェルスクリプト

`scripts/convert-drawio.sh`:

```bash
#!/bin/bash

DRAWIO="/Applications/draw.io.app/Contents/MacOS/draw.io"
BASE_DIR="docs/03_基本設計"

echo "Converting draw.io files to SVG and PNG..."

# システム構成図
"$DRAWIO" -x -f svg -o "$BASE_DIR/01_システム構成/システム構成図.svg" --border 20 "$BASE_DIR/01_システム構成/システム構成図.drawio"
"$DRAWIO" -x -f png -o "$BASE_DIR/01_システム構成/システム構成図.png" --width 2400 --border 20 "$BASE_DIR/01_システム構成/システム構成図.drawio"

# ネットワーク図
"$DRAWIO" -x -f svg -o "$BASE_DIR/02_ネットワーク/ネットワーク図.svg" --border 20 "$BASE_DIR/02_ネットワーク/ネットワーク図.drawio"
"$DRAWIO" -x -f png -o "$BASE_DIR/02_ネットワーク/ネットワーク図.png" --width 2400 --border 20 "$BASE_DIR/02_ネットワーク/ネットワーク図.drawio"

echo "Conversion completed!"
```

---

## draw.io MCP（Model Context Protocol）

**将来の拡張**:

draw.io の MCP サーバーを使用すると、Claude が直接 draw.io ファイルを読み書きできるようになります。

**メリット**:
- Claude が図を自動生成・編集できる
- 設計書の内容から図を自動生成
- 図の内容を解析してドキュメント化

**設定方法**:
（詳細は `.claude/docs/30_mcp/` に別途追加予定）

---

## 選択ガイド

### Mermaid を選ぶ場合
- ✅ プロジェクト規模が小〜中
- ✅ 図がシンプル
- ✅ Git 差分が重要
- ✅ Claude に図を生成・編集してほしい

### draw.io を選ぶ場合
- ✅ プロジェクト規模が中〜大
- ✅ 図が複雑（マルチアカウント、複雑なネットワーク等）
- ✅ AWS 公式アイコンを使いたい
- ✅ 見栄えの良い図が必要（プレゼン、提案書等）

---

## 参考リンク

- [draw.io Desktop](https://github.com/jgraph/drawio-desktop)
- [draw.io CLI Documentation](https://github.com/jgraph/drawio-desktop#command-line)
- [AWS Architecture Icons](https://aws.amazon.com/architecture/icons/)
- [Mermaid Documentation](https://mermaid.js.org/)

---

**作成者**: PM
**最終更新**: 2025-10-29
