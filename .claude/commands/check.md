# Check Command - 生成物品質チェック

## 概要

生成されたファイル（コード、ドキュメント等）が、
**要件・設計・技術標準・規約**に合っているかを再確認します。

## 目的

実装後に、生成物が以下の基準を満たしているか検証:
1. ユーザー要望（要件定義）
2. 設計書（実装方針）
3. 技術標準
4. プロジェクト固有規約

## コマンド一覧

```bash
# 最近生成したファイルをチェック
/check

# すべての生成物を一括チェック
/check all

# 特定のファイルをチェック
/check <file-path>
```

---

## チェック基準（優先順位順）

### 1️⃣ ユーザー要望（最優先）

**参照:** `docs/02_要件定義書.md`

**チェック内容:**
- 機能要件を満たしているか
- 非機能要件を満たしているか
- ユーザーが求めている成果物になっているか

**判定:**
ユーザー要望に合っていない場合は、**最優先で修正**

---

### 2️⃣ 設計書（実装方針）

**参照:**
- `docs/03_基本設計書.md` の「実装方針」セクション
- `docs/04_詳細設計書.md` の「ファイル構成」セクション

**チェック内容:**
- ファイル分割方針に従っているか
- ディレクトリ構成に従っているか
- モジュール分割方針に従っているか
- 命名規則に従っているか

**判定:**
設計書の実装方針に従っていない場合は、**高優先度で修正**

設計書で決めた方針は、プロジェクト固有の合理的な判断のため。

---

### 3️⃣ 技術標準

**参照:** `.claude/docs/40_standards/`

**チェック内容:**
- ファイル種別に応じた技術標準を適用
- ベストプラクティスに従っているか

**判定:**
技術標準に従っていない場合は、**中優先度で修正または説明**

ただし、設計書で合理的な理由により技術標準と異なる方針を採用している場合は、
設計書を優先。

---

### 4️⃣ プロジェクト固有規約

**参照:** `docs/standards/`（存在する場合）

**チェック内容:**
- プロジェクトで決めた独自ルールに従っているか

**判定:**
プロジェクト固有規約に従っていない場合は、**低優先度で修正**

---

## 各コマンドの詳細

### `/check` - 最近生成したファイルをチェック

**用途:**
- 生成直後の品質確認
- 再確認用

**処理フロー:**
1. 最近生成したファイルを特定（`.claude-state/tasks.json`から）
2. ファイル種別を判定
3. 各チェック基準を適用
4. 結果を表示

**出力:**
- 対象ファイル一覧
- 1️⃣ ユーザー要望チェック
- 2️⃣ 設計書チェック
- 3️⃣ 技術標準チェック
- 4️⃣ プロジェクト固有規約チェック
- チェック結果サマリー
- 修正提案（問題がある場合）

---

### `/check all` - 全生成物一括チェック

**用途:**
- プロジェクト全体の品質確認
- フェーズ完了前の最終チェック
- 問題ファイルの発見

**処理フロー:**
1. プロジェクト内のすべての生成ファイルを収集
2. ファイル種別ごとにグループ化
3. 各ファイルをチェック
4. 全体サマリーを生成

**出力:**
- 生成物一覧
- ファイル別チェック結果（簡潔版）
- 全体サマリー（準拠率、問題ファイル数等）
- 発見された問題
- 推奨アクション
- 今後の改善提案

---

### `/check <file-path>` - 特定ファイルをチェック

**用途:**
- 特定ファイルの詳細チェック
- 過去のファイルの再確認
- 手動修正後の確認

**処理フロー:**
1. 指定されたファイルを読み込む
2. ファイル種別を判定
3. 該当する技術標準を特定
4. 詳細にチェック

**出力:**
- ファイル情報（サイズ、最終更新等）
- 適用すべき技術標準
- 詳細チェック結果（行番号付き）
- 問題箇所の指摘
- 修正方法の提案

---

## チェック対象ファイルと適用基準

### ドキュメント
- `docs/**/*.md`
- 適用基準:
  - 1️⃣ ユーザー要望（内容の妥当性）
  - 2️⃣ 設計書（一貫性）

### CloudFormation
- `infra/**/*.yaml`
- 適用基準:
  - 1️⃣ ユーザー要望（要件定義）
  - 2️⃣ 設計書（実装方針、ファイル分割）
  - 3️⃣ CloudFormation技術標準 (`.claude/docs/40_standards/45_cloudformation.md`)
  - 3️⃣ セキュリティ標準 (`.claude/docs/40_standards/49_security.md`)

### Terraform
- `infra/**/*.tf`
- 適用基準:
  - 1️⃣ ユーザー要望
  - 2️⃣ 設計書
  - 3️⃣ Terraform技術標準 (`.claude/docs/40_standards/46_terraform.md`)
  - 3️⃣ セキュリティ標準

### Python
- `**/*.py`
- 適用基準:
  - 1️⃣ ユーザー要望
  - 2️⃣ 設計書
  - 3️⃣ Python技術標準 (`.claude/docs/40_standards/41_python.md`)
  - 3️⃣ セキュリティ標準

### TypeScript
- `**/*.ts`, `**/*.tsx`
- 適用基準:
  - 1️⃣ ユーザー要望
  - 2️⃣ 設計書
  - 3️⃣ TypeScript技術標準 (`.claude/docs/40_standards/42_typescript.md`)
  - 3️⃣ セキュリティ標準

### C#
- `**/*.cs`
- 適用基準:
  - 1️⃣ ユーザー要望
  - 2️⃣ 設計書
  - 3️⃣ C#技術標準 (`.claude/docs/40_standards/43_csharp.md`)
  - 3️⃣ セキュリティ標準

### Go
- `**/*.go`
- 適用基準:
  - 1️⃣ ユーザー要望
  - 2️⃣ 設計書
  - 3️⃣ Go技術標準 (`.claude/docs/40_standards/44_go.md`)
  - 3️⃣ セキュリティ標準

---

## 自動実行

Claude は以下のタイミングで自動的に `/check` を実行します:

1. **ファイル生成後**
   - コード生成直後
   - ドキュメント生成直後

2. **タスク完了時**
   - タスクで生成したすべてのファイルをチェック

ユーザーが手動で実行することも可能です。

---

## 注意事項

### 優先順位を守る

1. ユーザー要望（最優先）
2. 設計書（高優先度）
3. 技術標準（中優先度）
4. プロジェクト固有規約（低優先度）

技術標準はガイドラインです。
ユーザー要望や設計書で合理的な判断により異なる方針を採用している場合は、
それを優先します。

### 柔軟な対応

技術標準に従っていない場合でも、
設計書で理由が説明されていれば問題なしと判定します。

---

## 例: チェック結果の解釈

### ケース1: 技術標準違反だが設計書で説明されている

```
3️⃣ 技術標準チェック:
- ❌ ファイル分割: 752行（基準: 300行以内）

2️⃣ 設計書チェック:
- ✅ 設計書に「ネスト構造に分割」と記載

総合判定: ❌ 設計書の方針に従っていない
→ 修正必要（設計書を優先）
```

### ケース2: 技術標準違反だが設計書で合理的理由あり

```
3️⃣ 技術標準チェック:
- ❌ ファイル分割: 400行（基準: 300行以内）

2️⃣ 設計書チェック:
- ✅ 設計書に「400行程度だが、機能的に分割不可のため1ファイル」と記載

総合判定: ✅ 問題なし
→ 設計書で合理的に説明されているため
```

---

## まとめ

`/check` コマンドは、生成物の品質を保証するための再確認ツールです。

**チェック基準の優先順位:**
1. ユーザー要望（何を作るか）
2. 設計書（どう作るか）
3. 技術標準（ベストプラクティス）
4. プロジェクト固有規約

これにより、ユーザーの意図に沿った、設計通りの、品質の高い成果物を保証します。
